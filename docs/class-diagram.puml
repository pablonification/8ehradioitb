@startuml
!theme plain
skinparam sequenceArrowThickness 2
skinparam roundcorner 20
skinparam maxmessagesize 60

package "Frontend Components" {
  class RadioPlayer {
    - isPlaying: boolean
    - volume: number
    - isBuffering: boolean
    - audioRef: RefObject
    - playPromiseRef: RefObject
    + handlePlay(): void
    + handlePause(): void
    + handleLoadStart(): void
    + handleCanPlay(): void
    + handleLoadedData(): void
    + handleWaiting(): void
    + handlePlaying(): void
    + handlePause(): void
    + handleError(): void
  }

  class Navbar {
    - openDropdown: string
    - isMobileMenuOpen: boolean
    - isPlaying: boolean
    - volume: number
    - audioRef: RefObject
    - navbarRef: RefObject
    - onAir: boolean
    - playerTitle: string
    + playStream(): void
    + pauseStream(): void
    + togglePlay(): void
    + emitAudioStateChanged(): void
  }

  class Waveform {
    - waveformContainerRef: RefObject
    - wavesurferRef: RefObject
    - isPlaying: boolean
    - isLoading: boolean
    + handlePlayPause(): void
  }

  class ButtonPrimary {
    + onClick: function
    + className: string
    + children: ReactNode
  }

  class DashboardSidebar {
    - navItems: Array
    + render(): JSX.Element
  }

  class UserDropdown {
    - openDropdown: boolean
    + handleSignOut(): void
  }

  class PodcastAudioPlayer {
    - volume: number
    - muted: boolean
    - showPlayer: boolean
    - progress: number
    - duration: number
    - isRepeat: boolean
    - showMobileExpanded: boolean
    - hasLoadedPodcast: boolean
    - externalPauseRef: RefObject
    + handlePlay(): void
    + handlePause(): void
    + handleVolumeChange(): void
    + handleSeek(): void
  }
}

package "Custom Hooks" {
  class useRadioStream {
    - streamUrl: string
    - isLoading: boolean
    - error: string
    - retryCount: number
    - config: object
    + generateStreamUrl(): string
    + refreshStream(): string
    + handleStreamError(): void
    + getStreamUrl(): string
    + setIsLoading(): void
    + setError(): void
  }

  class useGlobalAudio {
    - audioInstance: Audio
    + getAudioRef(): RefObject
  }

  class useOnAirStatus {
    - isOnAir: boolean
    - loading: boolean
    - error: string
    + fetchOnAirStatus(): void
  }
}

package "API Routes" {
  class BlogAPI {
    + GET(): BlogPost[]
    + POST(): BlogPost
    + PUT(): BlogPost
    + DELETE(): void
  }

  class PodcastAPI {
    + GET(): Podcast[]
    + POST(): Podcast
    + PATCH(): Podcast
    + DELETE(): void
  }

  class ShortLinkAPI {
    + GET(): ShortLink[]
    + POST(): ShortLink
    + PUT(): ShortLink
    + generateUniqueSlug(): string
  }

  class UserAPI {
    + GET(): User[]
    + PATCH(): User
  }

  class AuthAPI {
    + signIn(): Session
    + signOut(): void
    + getSession(): Session
  }

  class StreamAPI {
    + GET(): StreamConfig
  }

  class TuneTrackerAPI {
    + GET(): TuneTrackerEntry[]
    + POST(): TuneTrackerEntry
    + PATCH(): TuneTrackerEntry
  }

  class RedirectAPI {
    + GET(): RedirectResponse
  }
}

package "Database Models" {
  class User {
    + id: string
    + name: string
    + email: string
    + emailVerified: DateTime
    + image: string
    + role: string
    + createdAt: DateTime
    + authored: AuthorOnPost[]
    + accounts: Account[]
    + sessions: Session[]
    + shortLinks: ShortLink[]
    + podcasts: Podcast[]
  }

  class BlogPost {
    + id: string
    + title: string
    + slug: string
    + content: string
    + description: string
    + readTime: string
    + category: string
    + mainImage: string
    + tags: string[]
    + isFeatured: boolean
    + authors: AuthorOnPost[]
    + createdAt: DateTime
    + updatedAt: DateTime
  }

  class AuthorOnPost {
    + id: string
    + userId: string
    + postId: string
    + user: User
    + post: BlogPost
  }

  class ShortLink {
    + id: string
    + destination: string
    + slug: string
    + title: string
    + domain: string
    + password: string
    + isActive: boolean
    + createdAt: DateTime
    + updatedAt: DateTime
    + userId: string
    + user: User
    + clicks: ShortLinkClick[]
  }

  class ShortLinkClick {
    + id: string
    + shortLinkId: string
    + shortLink: ShortLink
    + ipAddress: string
    + userAgent: string
    + referer: string
    + country: string
    + city: string
    + clickedAt: DateTime
  }

  class Podcast {
    + id: string
    + title: string
    + subtitle: string
    + description: string
    + date: string
    + duration: string
    + audioUrl: string
    + image: string
    + coverImage: string
    + createdAt: DateTime
    + updatedAt: DateTime
    + authorId: string
    + author: User
  }

  class PlayerConfig {
    + id: string
    + title: string
    + subtitle: string
    + coverImage: string
    + coverImages: string[]
    + updatedAt: DateTime
  }

  class StreamConfig {
    + id: string
    + baseUrls: string[]
    + defaultUrl: string
    + fallbackUrl: string
    + onAir: boolean
    + updatedAt: DateTime
  }

  class TuneTrackerEntry {
    + id: string
    + order: number
    + title: string
    + artist: string
    + coverImage: string
    + audioUrl: string
    + updatedAt: DateTime
  }

  class Account {
    + id: string
    + userId: string
    + type: string
    + provider: string
    + providerAccountId: string
    + refresh_token: string
    + access_token: string
    + expires_at: number
    + token_type: string
    + scope: string
    + id_token: string
    + session_state: string
    + user: User
  }

  class Session {
    + id: string
    + sessionToken: string
    + userId: string
    + expires: DateTime
    + user: User
  }

  class WhitelistedEmail {
    + id: string
    + email: string
    + createdAt: DateTime
  }

  class ProgramVideo {
    + id: string
    + title: string
    + link: string
    + thumbnail: string
    + thumbnailKey: string
    + createdAt: DateTime
    + updatedAt: DateTime
  }
}

package "Utility Functions" {
  class roleUtils {
    + splitRoles(roleString): string[]
    + hasRole(roleString, role): boolean
    + hasAnyRole(roleString, roles): boolean
  }

  class prisma {
    + blogPost: PrismaClient
    + user: PrismaClient
    + podcast: PrismaClient
    + shortLink: PrismaClient
    + tuneTrackerEntry: PrismaClient
    + playerConfig: PrismaClient
    + streamConfig: PrismaClient
  }
}

' Relationships
RadioPlayer --> useRadioStream : uses
Navbar --> useRadioStream : uses
Navbar --> useGlobalAudio : uses
PodcastAudioPlayer --> useGlobalAudio : uses
Waveform --> useGlobalAudio : uses

BlogAPI --> BlogPost : manages
BlogAPI --> AuthorOnPost : manages
BlogAPI --> User : manages
PodcastAPI --> Podcast : manages
PodcastAPI --> User : manages
ShortLinkAPI --> ShortLink : manages
ShortLinkAPI --> ShortLinkClick : manages
UserAPI --> User : manages
AuthAPI --> User : manages
AuthAPI --> Account : manages
AuthAPI --> Session : manages
AuthAPI --> WhitelistedEmail : manages
TuneTrackerAPI --> TuneTrackerEntry : manages
StreamAPI --> StreamConfig : manages

User ||--o{ AuthorOnPost : "authors posts"
BlogPost ||--o{ AuthorOnPost : "has authors"
User ||--o{ ShortLink : "creates"
ShortLink ||--o{ ShortLinkClick : "tracks clicks"
User ||--o{ Podcast : "creates"
User ||--o{ Account : "has accounts"
User ||--o{ Session : "has sessions"

BlogAPI --> roleUtils : uses
PodcastAPI --> roleUtils : uses
ShortLinkAPI --> roleUtils : uses
UserAPI --> roleUtils : uses
TuneTrackerAPI --> roleUtils : uses

BlogAPI --> prisma : uses
PodcastAPI --> prisma : uses
ShortLinkAPI --> prisma : uses
UserAPI --> prisma : uses
AuthAPI --> prisma : uses
TuneTrackerAPI --> prisma : uses
StreamAPI --> prisma : uses

@enduml
