@startuml
!theme plain
skinparam sequenceArrowThickness 2
skinparam roundcorner 20
skinparam maxmessagesize 60

' 1. Play Radio Stream
title Play Radio Stream Sequence
participant Guest
participant RadioPlayer
participant useRadioStream
participant StreamAPI
participant StreamConfig
participant Audio

Guest -> RadioPlayer: Click play button
RadioPlayer -> useRadioStream: getStreamUrl()
useRadioStream -> StreamAPI: GET /api/stream-config
StreamAPI -> StreamConfig: findFirst()
StreamConfig --> StreamAPI: config data
StreamAPI --> useRadioStream: stream config
useRadioStream -> useRadioStream: generateStreamUrl()
useRadioStream --> RadioPlayer: stream URL
RadioPlayer -> Audio: src = streamUrl
RadioPlayer -> Audio: play()
Audio --> RadioPlayer: playing event
RadioPlayer -> RadioPlayer: setIsPlaying(true)
RadioPlayer --> Guest: Audio playing

' 2. Sign in with Google (OAuth 2.0)
title Sign in with Google Sequence
participant Admin
participant LoginPage
participant AuthAPI
participant GoogleProvider
participant WhitelistedEmail
participant User
participant Session

Admin -> LoginPage: Click "Sign in with Google"
LoginPage -> AuthAPI: signIn("google")
AuthAPI -> GoogleProvider: authenticate()
GoogleProvider --> AuthAPI: profile data
AuthAPI -> WhitelistedEmail: findFirst(email)
WhitelistedEmail --> AuthAPI: whitelist check
AuthAPI -> User: findUnique(email)
User --> AuthAPI: user data
AuthAPI -> Session: create()
Session --> AuthAPI: session token
AuthAPI --> LoginPage: session data
LoginPage -> LoginPage: redirect to /dashboard
LoginPage --> Admin: Dashboard access

' 3. Manage Podcasts
title Manage Podcasts Sequence
participant Admin
participant PodcastDashboard
participant PodcastAPI
participant prisma
participant Podcast
participant User

Admin -> PodcastDashboard: Access podcast management
PodcastDashboard -> PodcastAPI: GET /api/podcast
PodcastAPI -> prisma: podcast.findMany()
prisma -> Podcast: query podcasts
Podcast --> prisma: podcast data
prisma --> PodcastAPI: podcasts array
PodcastAPI --> PodcastDashboard: podcast list
PodcastDashboard --> Admin: Display podcasts

Admin -> PodcastDashboard: Create new podcast
PodcastDashboard -> PodcastAPI: POST /api/podcast
PodcastAPI -> prisma: podcast.create()
prisma -> Podcast: insert new podcast
Podcast --> prisma: created podcast
prisma --> PodcastAPI: podcast data
PodcastAPI --> PodcastDashboard: success response
PodcastDashboard --> Admin: Podcast created

' 4. Browse Podcasts
title Browse Podcasts Sequence
participant Guest
participant PodcastPage
participant PodcastAPI
participant prisma
participant Podcast
participant PodcastAudioPlayer
participant useGlobalAudio

Guest -> PodcastPage: Navigate to podcasts
PodcastPage -> PodcastAPI: GET /api/podcast
PodcastAPI -> prisma: podcast.findMany()
prisma -> Podcast: query podcasts
Podcast --> prisma: podcast data
prisma --> PodcastAPI: podcasts array
PodcastAPI --> PodcastPage: podcast list
PodcastPage --> Guest: Display podcast list

Guest -> PodcastAudioPlayer: Click play on podcast
PodcastAudioPlayer -> useGlobalAudio: getAudioRef()
useGlobalAudio --> PodcastAudioPlayer: audio reference
PodcastAudioPlayer -> PodcastAudioPlayer: set audioUrl
PodcastAudioPlayer -> PodcastAudioPlayer: setIsPlaying(true)
PodcastAudioPlayer --> Guest: Podcast playing

' 5. Manage Short Links
title Manage Short Links Sequence
participant Admin
participant ShortLinkDashboard
participant ShortLinkAPI
participant prisma
participant ShortLink
participant User

Admin -> ShortLinkDashboard: Access short links
ShortLinkDashboard -> ShortLinkAPI: GET /api/shortlinks
ShortLinkAPI -> prisma: shortLink.findMany()
prisma -> ShortLink: query short links
ShortLink --> prisma: short link data
prisma --> ShortLinkAPI: short links array
ShortLinkAPI --> ShortLinkDashboard: short link list
ShortLinkDashboard --> Admin: Display short links

Admin -> ShortLinkDashboard: Create short link
ShortLinkDashboard -> ShortLinkAPI: POST /api/shortlinks
ShortLinkAPI -> ShortLinkAPI: generateUniqueSlug()
ShortLinkAPI -> prisma: shortLink.create()
prisma -> ShortLink: insert new short link
ShortLink --> prisma: created short link
prisma --> ShortLinkAPI: short link data
ShortLinkAPI --> ShortLinkDashboard: success response
ShortLinkDashboard --> Admin: Short link created

' 6. Open Short Link / Redirect
title Open Short Link Sequence
participant Guest
participant RedirectAPI
participant prisma
participant ShortLink
participant ShortLinkClick

Guest -> RedirectAPI: GET /api/redirect/[slug]
RedirectAPI -> prisma: shortLink.findUnique(slug)
prisma -> ShortLink: query by slug
ShortLink --> prisma: short link data
prisma --> RedirectAPI: short link found
RedirectAPI -> prisma: shortLinkClick.create()
prisma -> ShortLinkClick: insert click record
ShortLinkClick --> prisma: click data
prisma --> RedirectAPI: click recorded
RedirectAPI -> RedirectAPI: redirect to destination
RedirectAPI --> Guest: HTTP redirect to destination

' 7. Manage Blog Posts
title Manage Blog Posts Sequence
participant Admin
participant BlogDashboard
participant BlogAPI
participant prisma
participant BlogPost
participant AuthorOnPost
participant User

Admin -> BlogDashboard: Access blog management
BlogDashboard -> BlogAPI: GET /api/blog
BlogAPI -> prisma: blogPost.findMany()
prisma -> BlogPost: query blog posts
BlogPost --> prisma: blog post data
prisma --> BlogAPI: blog posts array
BlogAPI --> BlogDashboard: blog post list
BlogDashboard --> Admin: Display blog posts

Admin -> BlogDashboard: Create new blog post
BlogDashboard -> BlogAPI: POST /api/blog
BlogAPI -> prisma: blogPost.create()
prisma -> BlogPost: insert new blog post
BlogPost --> prisma: created blog post
prisma -> AuthorOnPost: create author relationship
AuthorOnPost --> prisma: author data
prisma --> BlogAPI: blog post with authors
BlogAPI --> BlogDashboard: success response
BlogDashboard --> Admin: Blog post created

' 8. Control Playback (pause/volume)
title Control Playback Sequence
participant Guest
participant RadioPlayer
participant Navbar
participant Audio
participant useRadioStream

Guest -> Navbar: Click pause button
Navbar -> Navbar: pauseStream()
Navbar -> Audio: pause()
Audio --> Navbar: paused event
Navbar -> Navbar: setIsPlaying(false)
Navbar -> Navbar: emitAudioStateChanged(false)
Navbar --> Guest: Audio paused

Guest -> RadioPlayer: Adjust volume slider
RadioPlayer -> RadioPlayer: setVolume(value)
RadioPlayer -> Audio: volume = value
Audio --> RadioPlayer: volume changed
RadioPlayer --> Guest: Volume updated

' 9. Manage Tune Tracker
title Manage Tune Tracker Sequence
participant Admin
participant TuneTrackerDashboard
participant TuneTrackerAPI
participant prisma
participant TuneTrackerEntry

Admin -> TuneTrackerDashboard: Access tune tracker
TuneTrackerDashboard -> TuneTrackerAPI: GET /api/tune-tracker
TuneTrackerAPI -> prisma: tuneTrackerEntry.findMany()
prisma -> TuneTrackerEntry: query entries
TuneTrackerEntry --> prisma: entry data
prisma --> TuneTrackerAPI: entries array
TuneTrackerAPI --> TuneTrackerDashboard: tune list
TuneTrackerDashboard --> Admin: Display tune tracker

Admin -> TuneTrackerDashboard: Update tune entry
TuneTrackerDashboard -> TuneTrackerAPI: PATCH /api/tune-tracker
TuneTrackerAPI -> prisma: tuneTrackerEntry.updateMany()
prisma -> TuneTrackerEntry: update entries
TuneTrackerEntry --> prisma: updated entries
prisma --> TuneTrackerAPI: update result
TuneTrackerAPI --> TuneTrackerDashboard: success response
TuneTrackerDashboard --> Admin: Tune tracker updated

' 10. Access Dashboard (role-check)
title Access Dashboard Sequence
participant Admin
participant DashboardLayout
participant AuthAPI
participant Session
participant User
participant roleUtils
participant DashboardSidebar

Admin -> DashboardLayout: Navigate to /dashboard
DashboardLayout -> AuthAPI: getSession()
AuthAPI -> Session: findUnique(sessionToken)
Session --> AuthAPI: session data
AuthAPI -> User: findUnique(userId)
User --> AuthAPI: user data
AuthAPI --> DashboardLayout: session with user

DashboardLayout -> roleUtils: hasAnyRole(user.role, requiredRoles)
roleUtils -> roleUtils: splitRoles(roleString)
roleUtils --> DashboardLayout: role check result

alt Role authorized
    DashboardLayout -> DashboardSidebar: render sidebar
    DashboardSidebar --> Admin: Dashboard access granted
else Role not authorized
    DashboardLayout --> Admin: Access denied
end

@enduml
